
# Music Radar: План реализации в 6 этапов

## Этап 1: База данных и аутентификация

**Цель**: Создать фундамент для хранения данных и авторизации админа

**Что делаем**:
- Создаем enum типы: `track_status`, `source_type`, `submission_status`, `app_role`
- Создаем таблицы:
  - `tracks` - треки в ротации
  - `radio_state` - состояние радио (текущий трек, время старта)
  - `submissions` - сабмиты от артистов
  - `user_roles` - роли пользователей для админки
- Настраиваем функцию `has_role()` для безопасной проверки ролей
- Настраиваем RLS политики для всех таблиц
- Включаем Supabase Auth для email/password авторизации

---

## Этап 2: Страница Music Radar и плеер

**Цель**: Создать основной интерфейс радио для слушателей

**Что делаем**:
- Создаем страницу `/radar` (src/pages/Radar.tsx)
- Добавляем пункт "Radar" в навигацию
- Создаем компоненты:
  - `RadarPlayer.tsx` - основной контейнер плеера
  - `NowPlaying.tsx` - отображение текущего трека (обложка, артист, название)
  - `SoundCloudEmbed.tsx` - интеграция SoundCloud виджета
- Добавляем кнопку Play/Pause
- Стилизуем в общем стиле сайта (минимализм, андеграунд)

---

## Этап 3: Синхронизация радио

**Цель**: Реализовать эффект "радио" - все слышат одно и то же

**Что делаем**:
- Создаем хук `useRadioState.ts` для получения состояния радио
- Создаем хук `useRadioSync.ts` для синхронизации по времени
- Логика при заходе на страницу:
  - Получаем current_track_id и started_at
  - Вычисляем elapsed time
  - Запускаем с нужной позиции через SoundCloud Widget API
- Подключаем Supabase Realtime для обновлений в реальном времени
- Автоматическое переключение на следующий трек

---

## Этап 4: Форма сабмита и правовой блок

**Цель**: Дать артистам возможность предложить свои треки

**Что делаем**:
- Создаем компонент `SubmitForm.tsx`:
  - Поля: имя артиста, название трека, ссылка на SoundCloud
  - Email (опционально)
  - Чекбокс согласия с условиями
- Валидация через Zod
- Сохранение в таблицу submissions
- Создаем компонент `Disclaimer.tsx`:
  - Дисклеймер о некоммерческом проекте
  - Информация об использовании с разрешения артистов
  - Контакт для правообладателей

---

## Этап 5: Админ-панель

**Цель**: Интерфейс для управления радио

**Что делаем**:
- Создаем страницу `/radar-admin` (скрытая, без ссылки в меню)
- Компонент `AdminLogin.tsx` - форма входа через Supabase Auth
- Хук `useAdminAuth.ts` - проверка роли admin
- Компоненты админки:
  - `TracksList.tsx` - список треков с возможностью включения/выключения
  - `AddTrackForm.tsx` - добавление нового трека
  - `SubmissionsList.tsx` - просмотр и модерация сабмитов
- Ручная смена текущего трека

---

## Этап 6: Edge Function для автосмены треков

**Цель**: Автоматическое переключение треков без участия пользователя

**Что делаем**:
- Создаем Edge Function `radio-next-track`:
  - Проверяет, закончился ли текущий трек
  - Выбирает следующий трек из active ротации
  - Обновляет radio_state
- Настраиваем cron job для периодической проверки (каждую минуту)
- Альтернатива: вызов функции с клиента при окончании трека
- Тестирование полного цикла работы радио

---

## Визуальная схема

```text
Этап 1          Этап 2          Этап 3
+--------+      +--------+      +--------+
|   БД   | ---> | Плеер  | ---> | Синхро |
|  Auth  |      |   UI   |      | низация|
+--------+      +--------+      +--------+
                    |
    +---------------+---------------+
    |                               |
    v                               v
+--------+      +--------+      +--------+
| Сабмит | ---> | Админ  | ---> | Auto   |
| Форма  |      | Панель |      | Switch |
+--------+      +--------+      +--------+
Этап 4          Этап 5          Этап 6
```

---

**Готов начать с Этапа 1?** После одобрения плана я создам все необходимые таблицы и настрою аутентификацию.
